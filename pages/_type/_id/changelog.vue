<template>
  <div>
    <div v-for="version in versions" :key="version.id">
      <div class="version-header">
        <span :class="'circle ' + version.version_type" />
        <div class="version-header-text">
          <h2 class="name">
            <nuxt-link
              :to="`/${project.project_type}/${
                project.slug ? project.slug : project.id
              }/version/${encodeURIComponent(version.version_number)}`"
              >{{ version.name }}</nuxt-link
            >
          </h2>
          <span v-if="members.find((x) => x.user.id === version.author_id)">
            by
            <nuxt-link
              class="text-link"
              :to="
                '/user/' +
                members.find((x) => x.user.id === version.author_id).user
                  .username
              "
              >{{
                members.find((x) => x.user.id === version.author_id).user
                  .username
              }}</nuxt-link
            >
          </span>
          <span>
            on {{ $dayjs(version.date_published).format('MMM D, YYYY') }}</span
          >
        </div>
        <a
          :href="$parent.findPrimary(version).url"
          class="iconified-button"
          @click.prevent="
            $parent.downloadFile(
              $parent.findPrimary(version).hashes.sha1,
              $parent.findPrimary(version).url
            )
          "
        >
          <DownloadIcon />
          Download
        </a>
      </div>
      <div
        v-compiled-markdown="
          version.changelog ? version.changelog : 'No changelog specified.'
        "
        :class="'markdown-body ' + version.version_type"
      />
    </div>
  </div>
</template>
<script>
import { DownloadIcon } from 'vue-feather-icons'

export default {
  components: {
    DownloadIcon,
  },
  auth: false,
  props: {
    project: {
      type: Object,
      default() {
        return {}
      },
    },
    versions: {
      type: Array,
      default() {
        return []
      },
    },
    members: {
      type: Array,
      default() {
        return []
      },
    },
  },
  created() {
    this.$emit('update:link-bar', [['Changelog', 'changelog']])
  },
}
</script>

<style lang="scss" scoped>
.version-header {
  display: flex;
  align-items: center;

  .circle {
    width: 0.75rem;
    height: 0.75rem;
    border-radius: 50%;
    display: inline-block;
    margin-right: 0.25rem;

    &.alpha {
      background-color: var(--color-badge-red-bg);
    }

    &.release {
      background-color: var(--color-badge-green-bg);
    }

    &.beta {
      background-color: var(--color-badge-yellow-bg);
    }
  }

  .version-header-text {
    display: flex;
    align-items: baseline;
    font-size: var(--font-size-sm);
    margin: 0 0.75rem;

    h2 {
      margin: 0;
      font-size: var(--font-size-xl);
    }

    h2,
    span {
      padding-right: 0.25rem;
    }
  }
}

.markdown-body {
  margin: 0.5rem 0.5rem 1rem calc(0.375rem - 1px);
  padding-left: 1.275rem;
  border-left: 2px solid var(--color-text);

  &.alpha {
    border-left-color: var(--color-badge-red-bg);
  }

  &.release {
    border-left-color: var(--color-badge-green-bg);
  }

  &.beta {
    border-left-color: var(--color-badge-yellow-bg);
  }
}
</style>
